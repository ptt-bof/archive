<!DOCTYPE HTML  PUBLIC  "-//W3C//DTD HTML 3.2//EN">
<!-- YAMAUCHI Hitoshi's Page   -->
<!-- Copyright (C) By YAMAUCHI Hitoshi -->
<html>
<head>
<title>#150 PTT (in Japanese)</title>
<META http-equiv="Content-type" content="text/html;charset=EUC-JP">
<META name="Author" content="YAMAUCHI Hitoshi">
<LINK REV=MADE HREF="mailto:yamauchi@archi.is.tohoku.ac.jp">
</head>
<body>

<h2>
<!-- PTTNUMBER -->
第 150 回 PTT のお知らせ
<!-- /PTTNUMBER -->
</h2>

<p>今月のPTTのおしらせです．どうも遅くなってすみません．さて今回は，東
工大の太田(mohta)氏の登場です．皆さんも news で御存知の方だと思います
が，どのような話がきけるでしょうか．是非とも御参加ください．</p> 

<hr>
<!-- PTTDATE -->
日時: 1990年 2月 21日 (水)  18:30 から
<!-- /PTTDATE -->
<br>

<hr>
<!-- PTTPLACE -->
場所:東京工業大学総合情報処理センター3 階 演習室<br>
<!-- /PTTPLACE -->

<p>(東急大井町線，目蒲線大岡山駅下車すぐ．建物がわからない方は，守衛さ
んに聞いて下さい．)
</p>

<hr>
<!-- PTTTHEMA -->
話題: /tmp file system の高速化
<!-- /PTTTHEMA -->
<br>

<hr>
<!-- PTTTALKER -->
話者: 太田 昌孝 (東工大情報処理センター)
<!-- /PTTTALKER -->
<br>

<hr>
<!-- PTTABSTRACT -->
内容:<br>
<p>発表者が最近試みている delayed write を用いた /tmp file system の高
速化手法についてデモを交えながら解説する．</p>
<!-- /PTTABSTRACT -->
<hr>
<p>
食事:会場の直ぐそばにある学食が19時30分まで営業していますので，そ
ちらを御利用ください．(学食でテイクアウトすることも可能です．)あと，駅
前にマクドナルドがあります．</p>

<hr>
次々回:
1990年 1月 17日 (水)　慶應大 (予定)
<br>

<hr>
葉書の残りは     枚です<br><br>

差出人、幹事:<br>
<pre>
113　文京区本郷 7-3-1
東京大学工学部計数工学科  岩崎英哉
03-812-2111  ext. 7411
iwasaki@wadalab.t.u-tokyo.ac.jp
</pre>

<hr>

<h2>
第 150 回PTTメモ
</h2>

<hr>
日時: 1990年2月21日
<hr>
場所: 東工大総合情報処理センター3F演習室
<hr>
題目: /tmp file systemの高速化
<hr>
話者: 太田 昌孝(東工大)
<hr>
出席者: (順不同)<br>
<!-- PTTPRESENCE -->
野中 哲  (ライフボート),
伊知地 哲 (富士ゼロックス),
佐口 泰之  (富士ゼロックス),
渡辺 卓雄  (東工大),
久野 靖  (筑波大),
松本 豊  (日本サン),
原口 章司  (日本サン),
寺田 実  (電通大),
岩崎 英哉  (東大),
粕川 正光  (東工大),
角田 博保  (電通大),
前野 年紀  (東工大),
武内 和昭  (電通大),
森山 茂男  (電通大),
松田 裕幸  (東工大),
樋口 貴章  (日本サン),
古賀 俊哉  (PFU),
佐々木 崇郎 (慶大),
清水 和久  (日電ソフト),
石畑 清  (明大),
大野 浩之  (東工大),
籠谷 裕人  (東工大),
菊池 豊  (東工大),
三膳 孝通  (東工大)
<!-- /PTTPRESENCE -->
<hr>
<!-- PTTDISCUSSION -->
概要：<br>

<pre>
話者と手塚 宏史(SONY CSL)が最近行なったUNIXにおける/tmpファイルシステ
ムの高速化について紹介した。

/tmpファイルシステムの高速化の手法として、これまでメモリディスクが使わ
れているが、メインメモリの一部を利用するため、ファイルシステムの最大容
量が極めて制限される、パワーダウン時に内容が完全に失われる、などの短所
があった。

一方、UNIXでのディスクへの書き込みは、クラッシュ後でも信頼性は高いがディ
スク待ちの発生するsync write、ディスクへの転送はスケジュールされるので
かなり信頼できるasync write、バッファキャッシュと呼ばれるメモリの部分
へコピーするだけで転送は後でゆっくり行なう信頼性の低いdelayed writeの
三種類が使い分けられている。

そこで、/tmpでは信頼性があまり要求されないことを考え、マウント オプショ
ンとして、delayというものを追加し、すべての書き込みをdelayed writeで行
なうことを指定できるようにした。

実際に計測してみると、sync writeが頻発するような場合には、通常のディス
クの30倍、メモリディスクの倍の速度が得られた。ただし、コンパイルのよう
なCPUをよく使う仕事では改善は見られなかった。

delayオプションは、システムのインストールのように、途中でクラッシュし
たら全部やり直してよいような場合にも有効である。

また、ファイルシステムのサイズはディスクの量によってしか制限されないし、
クラッシュ後でもデータが保存されている可能性も大きいなど、メモリディス
クの問題点は解消できた。

					太田 昌孝
					mohta@cc.titech.ac.jp

In article <5020@titcce.cc.titech.ac.jp>
	mohta@necom830.cc.titech.ac.jp (Masataka Ohta) writes:
>そこで、/tmpでは信頼性があまり要求されないことを考え、マウント オプ
>ションとして、delayというものを追加し、すべての書き込みをdelayed 
>writeで行なうことを指定できるようにした。

	これ、 NEWS-OS 3.3 にある隠し?オプション -o async とは違うんですか?

>実際に計測してみると、sync writeが頻発するような場合には、通常
>のディスクの30倍、メモリディスクの倍の速度が得られた。ただし、コンパイ
>ルのようなCPUをよく使う仕事では改善は見られなかった。

	ということなので、早速試してみました。

Filesystem            kbytes    used   avail capacity  Mounted on
/dev/sd00a              7421    4231    2818    60%    /
/dev/sd04a              7429       9    6677     0%    /a

	で(sd4はMO)

$ cd /a; time sh -c 'dump 0f - / | restore rf -'

	だと、

default:      315.4 real         2.3 user         7.8 sys
async:	       96.9 real         2.4 user         6.7 sys
sync:	      458.3 real         2.0 user         6.9 sys

	と、3倍。

$ time cp /vmunix /a だと、

default:     0.7 real         0.0 user         0.3 sys
async:	     0.3 real         0.0 user         0.3 sys
sync:       28.5 real         0.0 user         0.3 sys

	10回連続させると、

default:    30.6 real         0.1 user         3.6 sys
async:       4.7 real         0.0 user         3.3 sys
sync:      294.9 real         0.1 user         4.7 sys

	100回で、

default:   312.0 real         1.1 user        35.3 sys
async:      36.1 real         1.0 user        31.2 sys

	と、8.5倍。

	30倍にはいかない...

	-o async は async であって delay ではないのだろうか??

# d-partition を切り出すのは面倒だ...
- -
					樋口@陶山研.生物系.長岡技大
					c31848@tansei.cc.u-tokyo.ac.jp
<!-- /PTTDISCUSSION -->
</pre>
<hr>


<!-- <hr> -->
<!--         <a href="Welcome.html">PTTのホームページ</a>に戻る -->
</body>
</html>